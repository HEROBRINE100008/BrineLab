<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Herobrine Code Vault</title>

<link href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Montserrat:wght@300;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">

<style>
:root {
    --bg: #050505;
    --panel: #0f0f0f;
    --accent: #c90000;
    --text: #e0e0e0;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    background: var(--bg);
    color: var(--text);
    font-family: Montserrat, sans-serif;
    height: 100vh;
    display: flex;
    flex-direction: column;
}

/* HEADER */
header {
    height: 60px;
    background: black;
    border-bottom: 2px solid var(--accent);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
}

/* LAYOUT */
.main {
    flex: 1;
    display: flex;
}

/* SIDEBAR */
.sidebar {
    width: 260px;
    background: #0a0a0a;
    border-right: 1px solid #333;
    overflow-y: auto;
}

.item {
    padding: 10px;
    cursor: pointer;
    display: flex;
    gap: 10px;
}

.item:hover {
    background: rgba(201,0,0,0.1);
    color: var(--accent);
}

/* WORKSPACE */
.workspace {
    flex: 1;
    display: flex;
}

/* EDITOR */
.editor {
    flex: 6;
    background: #111;
    display: flex;
    flex-direction: column;
}

.editor-header {
    padding: 10px;
    background: #1a1a1a;
    display: flex;
    justify-content: space-between;
}

button {
    background: var(--accent);
    border: none;
    padding: 5px 15px;
    color: white;
    cursor: pointer;
    font-family: 'Fira Code';
}

pre {
    margin: 0;
    padding: 20px;
    overflow: auto;
    height: 100%;
}

/* TERMINAL */
.terminal {
    flex: 4;
    background: black;
    display: flex;
    flex-direction: column;
    border-left: 1px solid #333;
}

.terminal-body {
    flex: 1;
    padding: 10px;
    font-family: 'Fira Code';
    color: #0f0;
    overflow-y: auto;
}

.terminal input {
    background: black;
    border: none;
    border-top: 1px solid #333;
    padding: 10px;
    color: #0f0;
    outline: none;
    font-family: 'Fira Code';
}
</style>
</head>

<body>

<header>
    <span style="color:#c90000;font-weight:bold;">HEROBRINE CODE VAULT</span>
    <i class="fab fa-github"></i>
</header>

<div class="main">
    <div class="sidebar" id="tree"></div>

    <div class="workspace">
        <div class="editor">
            <div class="editor-header">
                <span id="filename">Selecciona un archivo</span>
                <button onclick="runCode()">â–¶ RUN</button>
            </div>
            <pre><code id="code" class="language-none">// Esperando archivoâ€¦</code></pre>
        </div>

        <div class="terminal">
            <div class="terminal-body" id="terminal"></div>
            <input id="cmd" placeholder="help | run | clear | ls">
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

<script>
/* ================= CONFIG ================= */
const GITHUB_USER = 'HEROBRINE100008';
const GITHUB_REPO = 'BrineLab';
const BRANCH = 'main';

/* EXTENSIONES BINARIAS */
const BINARY_EXTENSIONS = ['db','sqlite','sqlite3','exe','bin','dll'];

/* ========================================= */

const tree = document.getElementById('tree');
const codeEl = document.getElementById('code');
const filenameEl = document.getElementById('filename');
const terminal = document.getElementById('terminal');
const input = document.getElementById('cmd');

let currentCode = '';
let currentLang = '';

function log(text) {
    terminal.innerHTML += text + '<br>';
    terminal.scrollTop = terminal.scrollHeight;
}

/* CARGAR REPO */
async function load(path = '') {
    const url = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${path}?ref=${BRANCH}`;
    const res = await fetch(url);
    const data = await res.json();

    tree.innerHTML = '';
    data.forEach(item => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `<i class="fas fa-${item.type === 'dir' ? 'folder' : 'file-code'}"></i>${item.name}`;
        div.onclick = () => item.type === 'dir' ? load(item.path) : openFile(item);
        tree.appendChild(div);
    });
}

/* ABRIR ARCHIVO */
async function openFile(file) {
    const ext = file.name.split('.').pop().toLowerCase();
    filenameEl.textContent = file.name;

    /* ðŸš« BINARIO */
    if (BINARY_EXTENSIONS.includes(ext)) {
        codeEl.className = 'language-none';
        codeEl.textContent =
`âš  ARCHIVO BINARIO DETECTADO

Este archivo es una base de datos SQLite u otro binario.
No puede mostrarse como texto.

âœ” Archivo: ${file.name}
âœ” Tipo: BINARIO
âœ” SoluciÃ³n:
  - DescÃ¡rgalo
  - Ãbrelo con DB Browser for SQLite
  - Ãšsalo desde Python (sqlite3)`;

        Prism.highlightElement(codeEl);
        log('Archivo binario bloqueado: ' + file.name);
        return;
    }

    /* TEXTO */
    const res = await fetch(file.download_url);
    currentCode = await res.text();
    currentLang = ext;

    codeEl.className = ext === 'py' ? 'language-python' : 'language-javascript';
    codeEl.textContent = currentCode;
    Prism.highlightElement(codeEl);

    log('Archivo cargado: ' + file.name);
}

/* EJECUTAR */
function runCode() {
    if (currentLang === 'js') sandboxJS(currentCode);
    else log('SimulaciÃ³n: ' + currentLang.toUpperCase() + ' (requiere backend)');
}

/* SANDBOX JS */
function sandboxJS(code) {
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    iframe.sandbox = 'allow-scripts';
    document.body.appendChild(iframe);

    iframe.contentWindow.console.log = (...args) => {
        args.forEach(a => log(a));
    };

    try {
        iframe.contentWindow.eval(code);
    } catch (e) {
        log('Error: ' + e.message);
    }
}

/* TERMINAL INPUT */
input.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
        const cmd = input.value;
        input.value = '';
        log('> ' + cmd);

        if (cmd === 'help') log('Comandos: help, run, clear, ls');
        else if (cmd === 'run') runCode();
        else if (cmd === 'clear') terminal.innerHTML = '';
        else if (cmd === 'ls') log(filenameEl.textContent || 'sin archivo');
        else log('Comando no reconocido');
    }
});

load();
</script>

</body>
</html>
